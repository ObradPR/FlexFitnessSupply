"use strict";const url=window.location.pathname;let proizvodi=[];const collapseMenuButton=document.querySelector("#toggle"),navMeni=document.querySelector("#nav__menu"),cartBtn=document.querySelector("#cart"),logo=document.querySelector("#logo");if(ajaxCall("navMeni",ispisNavMeni),collapseMenuButton.addEventListener("click",function(){$(navMeni).slideToggle()}),"/"===url||"/index.html"===url){let e=document.querySelector("#slider__promotion_container"),n=document.querySelector("#best__products_container");function t(e){let t="";for(let a of e)a.najprodavaniji&&(t+=ispisProizvodBloka(a));n.innerHTML=t}function a(n){let t="";for(let a of n)t+=`<li class="slide__promotion"><img src="${a.slika.src}" alt="${a.slika.alt}" /></li>`;e.innerHTML=t}$(document).ready(function(){$("#slider__promotion").skdslider({slideSelector:".slide__promotion",delay:4e3,animationSpeed:1e3,showNextPrev:!1,showPlayButton:!1,autoSlide:!0,animationType:"sliding"})}),ajaxCall("products",t),ajaxCall("promotion__products",a)}else if("/shop.html"===url){let r=document.querySelector("#sidebar__brands"),l=document.querySelector("#sidebar__categories"),i=document.querySelector("#all__products"),o=document.querySelector("#sortDdl"),s=document.querySelector("#searchTb");function c(e,n){let t="",a=1;for(let r of e)t+=`<div class="sidebar__row">
      <label for="${r.naziv}">${r.naziv}</label>
      <input type="checkbox" name="${r.naziv}" id="${r.naziv}" class="${n}" value="${a++}"/>
    </div>`;return t}function u(e){r.innerHTML=c(e,"brands"),document.querySelectorAll(".brands").forEach(e=>{e.addEventListener("change",g)})}function d(e){l.innerHTML=c(e,"categories"),document.querySelectorAll(".categories").forEach(e=>{e.addEventListener("change",g)})}function p(e){proizvodi=e;let n="";if(0===(e=f(e=S(e=h(e=m(e=v(e=y(e))))))).length)n+="<p>Nemamo proizvode za izabrane kategorije</p>";else for(let t of e)n+=ispisProizvodBloka(t);i.innerHTML=n}function f(e){let n=o.value;if("asc__name"===n)return e.sort((e,n)=>e.naziv>n.naziv?1:-1);if("desc__name"===n)return e.sort((e,n)=>e.naziv<n.naziv?1:-1);if("asc__price"===n)return e.sort((e,n)=>+e.cena.aktuelnaCena>+n.cena.aktuelnaCena?1:-1);if("asc__price"===n)return e.sort((e,n)=>+e.cena.aktuelnaCena>+n.cena.aktuelnaCena?1:-1);if("desc__price"===n)return e.sort((e,n)=>+e.cena.aktuelnaCena<+n.cena.aktuelnaCena?1:-1);else if("sort__star"===n)return e.sort((e,n)=>e.ocena.stars<n.ocena.stars?1:-1);else if("sort__comments"===n)return e.sort((e,n)=>e.ocena.komentari<n.ocena.komentari?1:-1);return e}function v(e){let n=[];return(document.querySelectorAll(".categories:checked").forEach(function(e){n.push(parseInt(e.value))}),0!=n.length)?e.filter(e=>e.kategorije.some(e=>n.includes(e))):e}function y(e){let n=[];return(document.querySelectorAll(".brands:checked").forEach(function(e){n.push(parseInt(e.value))}),0!=n.length)?e.filter(e=>n.includes(e.brend)):e}function m(e){let n=[];return(document.querySelectorAll(".stanje:checked").forEach(function(e){let t=e.getAttribute("id");"stanje__ima"===t&&n.push(!0),"stanje__nema"===t&&n.push(!1)}),0!=n.length)?e.filter(e=>n.includes(e.dostupnost)):e}function h(e){let n,t=[],a=[],r=[];return(document.querySelectorAll(".kolekcija").forEach(function(n){n.checked&&"novo"===n.id&&(t=e.filter(e=>!0===e.novo)),n.checked&&"akcija"===n.id&&(a=e.filter(e=>e.cena.staraCena)),n.checked&&"najprodavaniji"===n.id&&(r=e.filter(e=>!0===e.najprodavaniji))}),0!=(n=[...t,...a,...r]).length)?n:e}function S(e){let n=s.value;return e.filter(function(e){if(-1!=e.naziv.toUpperCase().indexOf(n.trim().toUpperCase()))return e})}function g(){ajaxCall("products",p)}ajaxCall("brand",u),ajaxCall("category",d),ajaxCall("products",p),o.addEventListener("change",function(){g()}),document.querySelectorAll(".stanje").forEach(function(e){e.addEventListener("change",g)}),document.querySelectorAll(".kolekcija").forEach(function(e){e.addEventListener("change",g)}),s.addEventListener("keyup",g),$(document).ready(function(){let e;null==(e=JSON.parse(localStorage.getItem("zaKupovinu")))&&(e=[]),document.querySelectorAll(".add__to_cart").forEach(n=>{n.addEventListener("click",function(t){t.preventDefault(),setTimeout(()=>{document.querySelector("#success__cart").style.display="none"},900),document.querySelector("#success__cart").style.display="block";let a=n.nextSibling.nextSibling.defaultValue,r=proizvodi.find(e=>e.id==a);r.dostupnost&&(e.push(r),dodajULocalStorage(e))})})})}else if("/contact.html"===url){let k=document.querySelector("#polje__tekst"),b=document.querySelector("#ddl__opcije"),q=document.querySelector("#form__subimt_btn"),j=document.querySelector("#broj__karaktera"),L=document.querySelector(".form_row__txtarea"),E=document.querySelector("#error__ime"),z=document.querySelector("#error__prezime"),M=document.querySelector("#error__telefon"),C=document.querySelector("#error__mejl"),T=document.querySelector("#error__poruka");function _(){let e=document.querySelector("#ime"),n=document.querySelector("#prezime"),t=document.querySelector("#telefon"),a=document.querySelector("#mejl"),r;x(e,n,t,a,document.querySelector("#polje__tekst"),document.querySelector("#ddl__opcije"))}function x(e,n,t,a,r,l){let i=/^[A-ZŽĆČŠĐ][a-zžćčšđ]+$/,o=!1;e.value.match(i)?E.style.display="none":(E.style.display="block",o=!0),n.value.match(i)?z.style.display="none":(z.style.display="block",o=!0),t.value.match(/^[\+]381\s6[0-9]{8}$/)?M.style.display="none":(M.style.display="block",o=!0),a.value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)?C.style.display="none":(C.style.display="block",o=!0),r.value.length>=50?(T.style.display="none",L.style.justifyContent="flex-end"):(L.style.justifyContent="space-between",T.style.display="block",o=!0),0!=l.value?b.style.border="1px solid #707070":(b.style.border="1px solid #fc7c78",o=!0),o||(e.value="",n.value="",t.value="",a.value="",r.value="",b.value="0",j.innerHTML=0)}k.addEventListener("keyup",function(){let e=k.value.length;j.innerHTML=e}),q.addEventListener("click",function(e){e.preventDefault(),_()})}else if("/cart.html"===url){let H,A=document.querySelector("#cart__products");function w(){H=JSON.parse(localStorage.getItem("zaKupovinu"))}function U(){w(),0==H.length&&(document.querySelector("#cart__empty").style.display="block",document.querySelector(".money").innerHTML=0)}function B(e){let n="",t,a=0,r=[...new Map(e.map(e=>[e.id,e])).values(),];for(let l of r)t=e.filter(e=>e.id==l.id).length,n+=`<div class="cart__product_container">
      <div class="cart__product">
        <div class="cart__product_img">
          <img src="${l.slika.src}" alt="${l.slika.alt}" />
        </div>
        <div class="cart__product_info">
          <h2>Naziv proizvoda</h2>
          <p>${l.naziv}</p>
        </div>
        <div class="cart__product_funn">
          <h3>Cena proizvoda: ${l.cena.aktuelnaCena} din.</h3>
          <div class="cart__product_funn-row">
            <p>Kolicina:</p>
            <button class="minus"><b>-</b></button>
            <span class="kol">${t}</span>
            <button class="plus"><b>+</b></button>
          </div>
          <p>Ukupna cena: <span class="cena__el">${l.cena.aktuelnaCena*t}</span> din.</p>
        </div>
      </div>
      <a href="#" class="del" id="${l.id}">Obrisi</a>
    </div>`,a+=+l.cena.aktuelnaCena*t;A.innerHTML=n,document.querySelector(".money").innerHTML=a}function D(e){return e.parentElement.parentElement.parentElement.nextSibling.nextSibling.id}function K(e,n,t){let a=document.querySelector(".money"),r,l,i;"previousSibling"==n&&(r=e.previousSibling.previousSibling),"nextSibling"==n&&((r=e.nextSibling.nextSibling).innerHTML=+r.innerHTML-1),i=H.find(e=>e.id==t).cena.aktuelnaCena,0==+r.innerHTML?(e.parentElement.parentElement.parentElement.parentElement.style.display="none",a.innerHTML=+a.innerHTML-+i):(l=e.parentElement.nextSibling.nextSibling.firstElementChild,"nextSibling"==n?(l.innerHTML=+l.innerHTML-+i,a.innerHTML=+a.innerHTML-+i):(r.innerHTML=+r.innerHTML+1,l.innerHTML=+l.innerHTML+ +i,a.innerHTML=+a.innerHTML+ +i))}function N(){localStorage.removeItem("zaKupovinu")}function P(){N(),dodajULocalStorage(H=[]),B(H),U()}U(),B(H),document.querySelectorAll(".plus").forEach(function(e){e.addEventListener("click",function(){let e=D(this);H.push(H.find(n=>n.id==e)),dodajULocalStorage(H),K(this,"previousSibling",e)})}),document.querySelectorAll(".minus").forEach(function(e){e.addEventListener("click",function(){let e=D(this),n=H.find(n=>n.id==e),t;for(let a in H)n==H[a]&&(t=a);K(this,"nextSibling",e),void 0!=t&&H.splice(t,1),dodajULocalStorage(H),U()})}),document.querySelectorAll("#cart__btns a").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),"del__all"==this.id&&P(),"buy__all"==this.id&&0!=H.length&&(P(),setTimeout(()=>{document.querySelector("#success__mess").style.display="none"},3e3),document.querySelector("#success__mess").style.display="block")})})}function ispisProizvodBloka(e,n){return n=`<div class="product__block">
  ${e.najprodavaniji?"<div class='bestseller'><img src='assets/img/bestseller.png' alt='bestseller mark' /></div>":""}
  ${e.cena.staraCena?"<div class='salemark'><img src='assets/img/salemark__15.png' alt='salemark 15%'/></div>":""}
  ${e.dostupnost?"":"<div class='rasprodato'><img src='assets/img/rasprodato.png' alt='rasprodato mark'/></div>"}
  <img
    src="${e.slika.src}"
    alt="${e.slika.alt}"
  />
  <h3>${e.naziv}</h3>
  <div class="prodcut__stats">
    <p>
      <span class="product__stars">(${e.ocena.stars})</span
      >${ispisiZvezdice(e.ocena.stars)}
    </p>
    <p><span class="product__coments">(${e.ocena.komentari})</span> Komentara</p>
  </div>
  <div id="product__info">
    <div id="price">
    <p>${e.cena.aktuelnaCena} RSD</p>
    <del>${e.cena.staraCena?e.cena.staraCena+" RSD":""}</del>
    </div>
    <a href="#" class="add__to_cart"><i class="fa-solid fa-bag-shopping"></i></a>
    <input type="hidden" value="${e.id}"/>
  </div>
</div>`}function ispisiZvezdice(e){let n="";e=Math.trunc(e);for(let t=0;t<e;t++)n+="<i class='fa-regular fa-star'></i>";return n}function ajaxCall(e,n){$.ajax({url:`assets/json/${e}.json`,type:"get",dataType:"json",success(e){n(e)},error(e){console.log(e)}})}function ispisNavMeni(e){let n="";for(let t of e)n+=`<li><a href="${t.href}">${t.naziv}</a></li>`;$("#nav__menu").html(n)}function dodajULocalStorage(e){localStorage.setItem("zaKupovinu",JSON.stringify(e))}